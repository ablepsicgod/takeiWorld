!function(t){var i={};function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(n,r,function(i){return t[i]}.bind(null,r));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=8)}([function(t,i,e){(function(t,e){var n,r=r||{};function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}r.scope={},r.ASSUME_ES5=!1,r.ASSUME_NO_NATIVE_MAP=!1,r.ASSUME_NO_NATIVE_SET=!1,r.defineProperty=r.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,i,e){t!=Array.prototype&&t!=Object.prototype&&(t[i]=e.value)},r.getGlobal=function(i){return"undefined"!=typeof window&&window===i?i:void 0!==t&&null!=t?t:i},r.global=r.getGlobal(this),r.polyfill=function(t,i,e,n){if(i){for(e=r.global,t=t.split("."),n=0;n<t.length-1;n++){var o=t[n];o in e||(e[o]={}),e=e[o]}(i=i(n=e[t=t[t.length-1]]))!=n&&null!=i&&r.defineProperty(e,t,{configurable:!0,writable:!0,value:i})}},r.polyfill("Array.prototype.fill",function(t){return t||function(t,i,e){var n=this.length||0;for(0>i&&(i=Math.max(0,n+i)),(null==e||e>n)&&(e=n),0>(e=Number(e))&&(e=Math.max(0,n+e)),i=Number(i||0);i<e;i++)this[i]=t;return this}},"es6","es3"),r.checkStringArgs=function(t,i,e){if(null==t)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(i instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return t+""},r.polyfill("String.prototype.repeat",function(t){return t||function(t){var i=r.checkStringArgs(this,null,"repeat");if(0>t||1342177279<t)throw new RangeError("Invalid count value");t|=0;for(var e="";t;)1&t&&(e+=i),(t>>>=1)&&(i+=i);return e}},"es6","es3"),r.stringPadding=function(t,i){return t=void 0!==t?String(t):" ",0<i&&t?t.repeat(Math.ceil(i/t.length)).substring(0,i):""},r.polyfill("String.prototype.padStart",function(t){return t||function(t,i){var e=r.checkStringArgs(this,null,"padStart");return r.stringPadding(i,t-e.length)+e}},"es8","es3"),r.owns=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.assign="function"==typeof Object.assign?Object.assign:function(t,i){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var o in n)r.owns(n,o)&&(t[o]=n[o])}return t},r.polyfill("Object.assign",function(t){return t||r.assign},"es6","es3"),r.SYMBOL_PREFIX="jscomp_symbol_",r.initSymbol=function(){r.initSymbol=function(){},r.global.Symbol||(r.global.Symbol=r.Symbol)},r.Symbol=(n=0,function(t){return r.SYMBOL_PREFIX+(t||"")+n++}),r.initSymbolIterator=function(){r.initSymbol();var t=r.global.Symbol.iterator;t||(t=r.global.Symbol.iterator=r.global.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&r.defineProperty(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return r.arrayIterator(this)}}),r.initSymbolIterator=function(){}},r.initSymbolAsyncIterator=function(){r.initSymbol();var t=r.global.Symbol.asyncIterator;t||(t=r.global.Symbol.asyncIterator=r.global.Symbol("asyncIterator")),r.initSymbolAsyncIterator=function(){}},r.arrayIterator=function(t){var i=0;return r.iteratorPrototype(function(){return i<t.length?{done:!1,value:t[i++]}:{done:!0}})},r.iteratorPrototype=function(t){return r.initSymbolIterator(),(t={next:t})[r.global.Symbol.iterator]=function(){return this},t},r.iteratorFromArray=function(t,i){r.initSymbolIterator(),t instanceof String&&(t+="");var e=0,n={next:function(){if(e<t.length){var r=e++;return{value:i(r,t[r]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},r.polyfill("Array.prototype.keys",function(t){return t||function(){return r.iteratorFromArray(this,function(t){return t})}},"es6","es3"),function(t){function i(t,i){return(t%i+i)%i}function n(t,i,e){return void 0===i&&(i=0),void 0===e&&(e=1),t<i?i:t>e?e:t}function r(t){return t.charAt(0).toUpperCase()+t.substring(1)}function a(t){for(var i=arguments.length,e=Array(1<i?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];var o=a.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(i,n,s,a){return"%"==t.charAt(a-1)?i.substring(1):e.length?(s=(n||s).split(","),n=s.shift()||"",(a=o[n.toLowerCase()])?(i=(i=e.shift())[a].apply(i,s),(n=n.charAt(0))!=n.toLowerCase()&&(i=r(i)),i):i):i})}function h(t){var i;if(t in V)var e=V[t];else{if("#"==t.charAt(0))if(3==(e=(t.match(/[0-9a-f]/gi)||[]).map(function(t){return parseInt(t,16)})).length)e=e.map(function(t){return 17*t});else for(i=0;3>i;i++)e[i+1]+=16*e[i],e.splice(i,1);else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(function(t){return parseInt(t)}):[0,0,0];V[t]=e}return e.slice()}function c(t){for(var i=arguments.length,e=Array(1<i?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];for(i=0;3>i;i++)for(n=0;n<e.length;n++)t[i]+=e[n][i];return t}function l(t,i,e){void 0===e&&(e=.5);for(var n=t.slice(),r=0;3>r;r++)n[r]=Math.round(n[r]+e*(i[r]-t[r]));return n}function u(t,i,e){void 0===e&&(e=.5),t=_(t),i=_(i);for(var n=0;3>n;n++)t[n]+=e*(i[n]-t[n]);return p(t)}function _(t){var i=t[0]/255,e=t[1]/255;t=t[2]/255;var n=Math.max(i,e,t),r=Math.min(i,e,t),o=0,s=(n+r)/2;if(n==r)r=0;else{var a=n-r;switch(r=.5<s?a/(2-n-r):a/(n+r),n){case i:o=(e-t)/a+(e<t?6:0);break;case e:o=(t-i)/a+2;break;case t:o=(i-e)/a+4}o/=6}return[o,r,s]}function f(t,i,e){return 0>e&&(e+=1),1<e&&--e,e<1/6?t+6*(i-t)*e:.5>e?i:e<2/3?t+(i-t)*(2/3-e)*6:t}function p(t){var i=t[2];if(0==t[1])return[i=Math.round(255*i),i,i];var e=t[1],n=2*i-(e=.5>i?i*(1+e):i+e-i*e);i=f(n,e,t[0]+1/3);var r=f(n,e,t[0]);return t=f(n,e,t[0]-1/3),[Math.round(255*i),Math.round(255*r),Math.round(255*t)]}function d(t){return t=h(t),36*Math.floor(.0234375*t[0])+6*Math.floor(.0234375*t[1])+1*Math.floor(.0234375*t[2])+16}function g(t,i){var e=[],n=0;t.replace(T,function(i,r,o,s){var a=t.substring(n,s);return a.length&&e.push({type:0,value:a}),e.push({type:"c"==r?2:3,value:o.trim()}),n=s+i.length,""});var r=t.substring(n);return r.length&&e.push({type:0,value:r}),function(t,i){i||(i=1/0);for(var e=0,n=0,r=-1;e<t.length;){var o=t[e];if(1==o.type&&(n=0,r=-1),0!=o.type)e++;else{for(;0==n&&" "==o.value.charAt(0);)o.value=o.value.substring(1);var s=o.value.indexOf("\n");if(-1!=s){for(o.value=v(t,e,s,!0),s=o.value.split("");s.length&&" "==s[s.length-1];)s.pop();o.value=s.join("")}if(o.value.length){if(n+o.value.length>i){for(s=-1;;){var a=o.value.indexOf(" ",s+1);if(-1==a)break;if(n+a>i)break;s=a}-1!=s?o.value=v(t,e,s,!0):-1!=r?(e=t[r],o=e.value.lastIndexOf(" "),e.value=v(t,r,o,!0),e=r):o.value=v(t,e,i-n,!1)}else n+=o.value.length,-1!=o.value.indexOf(" ")&&(r=e);e++}else t.splice(e,1)}}for(t.push({type:1}),i=null,n=0;n<t.length;n++)switch(r=t[n],r.type){case 0:i=r;break;case 1:if(i){for(r=i.value.split("");r.length&&" "==r[r.length-1];)r.pop();i.value=r.join("")}i=null}return t.pop(),t}(e,i)}function v(t,i,e,n){return n={type:0,value:t[i].value.substring(e+(n?1:0))},t.splice(i+1,0,{type:1},n),t[i].value.substring(0,e)}function m(t,i,e){e[i[t+1]]=e[t],i[e[t]]=i[t+1],e[t]=t+1,i[t+1]=t}function y(t,i,e){e[i[t]]=e[t],i[e[t]]=i[t],e[t]=t,i[t]=t}var b=(new(function(){function t(){this._c=this._s2=this._s1=this._s0=this._seed=0}var i=t.prototype;return i.getSeed=function(){return this._seed},i.setSeed=function(t){return this._seed=t=1>t?1/t:t,this._s0=2.3283064365386963e-10*(t>>>0),t=69069*t+1>>>0,this._s1=2.3283064365386963e-10*t,this._s2=2.3283064365386963e-10*(69069*t+1>>>0),this._c=1,this},i.getUniform=function(){var t=2091639*this._s0+2.3283064365386963e-10*this._c;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c},i.getUniformInt=function(t,i){var e=Math.max(t,i);return t=Math.min(t,i),Math.floor(this.getUniform()*(e-t+1))+t},i.getNormal=function(t,i){void 0===t&&(t=0),void 0===i&&(i=1);do{var e=2*this.getUniform()-1,n=2*this.getUniform()-1;n=e*e+n*n}while(1<n||0==n);return t+e*Math.sqrt(-2*Math.log(n)/n)*i},i.getPercentage=function(){return 1+Math.floor(100*this.getUniform())},i.getItem=function(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null},i.shuffle=function(t){var i=[];for(t=t.slice();t.length;){var e=t.indexOf(this.getItem(t));i.push(t.splice(e,1)[0])}return i},i.getWeightedValue=function(t){var i,e=0;for(n in t)e+=t[n];e*=this.getUniform();var n=0;for(i in t)if(n+=t[i],e<n)break;return i},i.getState=function(){return[this._s0,this._s1,this._s2,this._c]},i.setState=function(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this},i.clone=function(){return(new t).setState(this.getState())},t}())).setSeed(Date.now()),w=function(){function t(){}var i=t.prototype;return i.getContainer=function(){return null},i.setOptions=function(t){this._options=t},t}(),x=function(t){function i(){var i=t.call(this)||this;return i._ctx=document.createElement("canvas").getContext("2d"),i}s(i,t);var e=i.prototype;return e.schedule=function(t){requestAnimationFrame(t)},e.getContainer=function(){return this._ctx.canvas},e.setOptions=function(i){t.prototype.setOptions.call(this,i),i=(i.fontStyle?i.fontStyle+" ":"")+" "+i.fontSize+"px "+i.fontFamily,this._ctx.font=i,this._updateSize(),this._ctx.font=i,this._ctx.textAlign="center",this._ctx.textBaseline="middle"},e.clear=function(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)},e.eventToPosition=function(t,i){var e=this._ctx.canvas,n=e.getBoundingClientRect();return t-=n.left,i-=n.top,t*=e.width/n.width,i*=e.height/n.height,0>t||0>i||t>=e.width||i>=e.height?[-1,-1]:this._normalizedEventToPosition(t,i)},i}(w);a.map={s:"toString"};var M=Object.freeze({mod:i,clamp:n,capitalize:r,format:a}),C=function(t){function e(){var i=t.call(this)||this;return i._spacingX=0,i._spacingY=0,i._hexSize=0,i}s(e,t);var n=e.prototype;return n.draw=function(t,i){var e=t[2],n=t[3],r=t[4];if(t=[(t[0]+1)*this._spacingX,t[1]*this._spacingY+this._hexSize],this._options.transpose&&t.reverse(),i&&(this._ctx.fillStyle=r,this._fill(t[0],t[1])),e)for(this._ctx.fillStyle=n,i=[].concat(e),e=0;e<i.length;e++)this._ctx.fillText(i[e],t[0],Math.ceil(t[1]))},n.computeSize=function(t,i){return this._options.transpose&&(t+=i,t-=i=t-i),[Math.floor(t/this._spacingX)-1,Math.floor((i-2*this._hexSize)/this._spacingY+1)]},n.computeFontSize=function(t,i){this._options.transpose&&(t+=i,t-=i=t-i),t=Math.min(2*t/((this._options.width+1)*Math.sqrt(3))-1,i/(2+1.5*(this._options.height-1))),i=this._ctx.font,this._ctx.font="100px "+this._options.fontFamily;var e=Math.ceil(this._ctx.measureText("W").width);return this._ctx.font=i,t=Math.floor(t)+1,Math.ceil(2*t/(this._options.spacing*(1+e/100/Math.sqrt(3))))-1},n._normalizedEventToPosition=function(t,e){if(this._options.transpose){t+=e,t-=e=t-e;var n=this._ctx.canvas.width}else n=this._ctx.canvas.height;return i(e=Math.floor(e/(n/this._options.height)),2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]},n._fill=function(t,i){var e=this._hexSize,n=this._options.border,r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-e+n,i),r.lineTo(t-e/2+n,i+this._spacingX-n),r.lineTo(t+e/2-n,i+this._spacingX-n),r.lineTo(t+e-n,i),r.lineTo(t+e/2-n,i-this._spacingX+n),r.lineTo(t-e/2+n,i-this._spacingX+n),r.lineTo(t-e+n,i)):(r.moveTo(t,i-e+n),r.lineTo(t+this._spacingX-n,i-e/2+n),r.lineTo(t+this._spacingX-n,i+e/2-n),r.lineTo(t,i+e-n),r.lineTo(t-this._spacingX+n,i+e/2-n),r.lineTo(t-this._spacingX+n,i-e/2+n),r.lineTo(t,i-e+n)),r.fill()},n._updateSize=function(){var t=this._options,i=Math.ceil(this._ctx.measureText("W").width);if(this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose){i="height";var e="width"}else i="width",e="height";this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[e]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)},e}(x),S=function(t){function i(){var i=t.call(this)||this;return i._spacingX=0,i._spacingY=0,i._canvasCache={},i}s(i,t);var e=i.prototype;return e.setOptions=function(i){t.prototype.setOptions.call(this,i),this._canvasCache={}},e.draw=function(t,e){i.cache?this._drawWithCache(t):this._drawNoCache(t,e)},e._drawWithCache=function(t){var i=t[0],e=t[1],n=t[2],r=t[3],o=t[4];if((t=""+n+r+o)in this._canvasCache)var s=this._canvasCache[t];else{var a=this._options.border,h=(s=document.createElement("canvas")).getContext("2d");if(s.width=this._spacingX,s.height=this._spacingY,h.fillStyle=o,h.fillRect(a,a,s.width-a,s.height-a),n)for(h.fillStyle=r,h.font=this._ctx.font,h.textAlign="center",h.textBaseline="middle",n=[].concat(n),r=0;r<n.length;r++)h.fillText(n[r],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[t]=s}this._ctx.drawImage(s,i*this._spacingX,e*this._spacingY)},e._drawNoCache=function(t,i){var e=t[0],n=t[1],r=t[2],o=t[3];if(t=t[4],i&&(i=this._options.border,this._ctx.fillStyle=t,this._ctx.fillRect(e*this._spacingX+i,n*this._spacingY+i,this._spacingX-i,this._spacingY-i)),r)for(this._ctx.fillStyle=o,r=[].concat(r),o=0;o<r.length;o++)this._ctx.fillText(r[o],(e+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))},e.computeSize=function(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]},e.computeFontSize=function(t,i){t=Math.floor(t/this._options.width),i=Math.floor(i/this._options.height);var e=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;var n=Math.ceil(this._ctx.measureText("W").width);return this._ctx.font=e,1<(t=n/100*i/t)&&(i=Math.floor(i/t)),Math.floor(i/this._options.spacing)},e._normalizedEventToPosition=function(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]},e._updateSize=function(){var t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY},i}(x);S.cache=!1;var k=function(t){function i(){var i=t.call(this)||this;return i._colorCanvas=document.createElement("canvas"),i}s(i,t);var e=i.prototype;return e.draw=function(t,i){var e=t[0],n=t[1],r=t[2],o=t[3],s=t[4];t=this._options.tileWidth;var a=this._options.tileHeight;if(i&&(this._options.tileColorize?this._ctx.clearRect(e*t,n*a,t,a):(this._ctx.fillStyle=s,this._ctx.fillRect(e*t,n*a,t,a))),r)for(i=[].concat(r),o=[].concat(o),s=[].concat(s),r=0;r<i.length;r++){var h=this._options.tileMap[i[r]];if(!h)throw Error('Char "'+i[r]+'" not found in tileMap');if(this._options.tileColorize){var c=this._colorCanvas,l=c.getContext("2d");l.globalCompositeOperation="source-over",l.clearRect(0,0,t,a);var u=o[r],_=s[r];l.drawImage(this._options.tileSet,h[0],h[1],t,a,0,0,t,a),"transparent"!=u&&(l.fillStyle=u,l.globalCompositeOperation="source-atop",l.fillRect(0,0,t,a)),"transparent"!=_&&(l.fillStyle=_,l.globalCompositeOperation="destination-over",l.fillRect(0,0,t,a)),this._ctx.drawImage(c,e*t,n*a,t,a)}else this._ctx.drawImage(this._options.tileSet,h[0],h[1],t,a,e*t,n*a,t,a)}},e.computeSize=function(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]},e.computeFontSize=function(){throw Error("Tile backend does not understand font size")},e._normalizedEventToPosition=function(t,i){return[Math.floor(t/this._options.tileWidth),Math.floor(i/this._options.tileHeight)]},e._updateSize=function(){var t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight},i}(x),V={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};x=Object.freeze({fromString:h,add:function(t){for(var i=t.slice(),e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(e=0;3>e;e++)for(r=0;r<n.length;r++)i[e]+=n[r][e];return i},add_:c,multiply:function(t){for(var i=t.slice(),e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(e=0;3>e;e++){for(r=0;r<n.length;r++)i[e]*=n[r][e]/255;i[e]=Math.round(i[e])}return i},multiply_:function(t){for(var i=arguments.length,e=Array(1<i?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];for(i=0;3>i;i++){for(n=0;n<e.length;n++)t[i]*=e[n][i]/255;t[i]=Math.round(t[i])}return t},interpolate:l,lerp:l,interpolateHSL:u,lerpHSL:u,randomize:function(t,i){i instanceof Array||(i=Math.round(b.getNormal(0,i))),t=t.slice();for(var e=0;3>e;e++)t[e]+=i instanceof Array?Math.round(b.getNormal(0,i[e])):i;return t},rgb2hsl:_,hsl2rgb:p,toRGB:function(t){return"rgb("+t.map(function(t){return n(t,0,255)}).join(",")+")"},toHex:function(t){return"#"+t.map(function(t){return n(t,0,255).toString(16).padStart(2,"0")}).join("")}});var K=function(t){function i(){var i=t.call(this)||this;return i._offset=[0,0],i._cursor=[-1,-1],i._lastColor="",i}s(i,t);var n=i.prototype;return n.schedule=function(t){setTimeout(t,1e3/60)},n.setOptions=function(i){t.prototype.setOptions.call(this,i);var e=[i.width,i.height];this._offset=this.computeSize().map(function(t,i){return Math.floor((t-e[i])/2)})},n.clear=function(){e.stdout.write("[0;48;5;"+d(this._options.bg)+"m[2J")},n.draw=function(t,i){var n=t[2],r=t[3],o=t[4],s=this._offset[0]+t[0],a=this._offset[1]+t[1];t=this.computeSize(),0>s||s>=t[0]||0>a||a>=t[1]||(s===this._cursor[0]&&a===this._cursor[1]||(e.stdout.write("["+(a+1)+";"+(s+1)+"H"),this._cursor[0]=s,this._cursor[1]=a),i&&(n||(n=" ")),n&&((i="[0;38;5;"+d(r)+";48;5;"+d(o)+"m")!==this._lastColor&&(e.stdout.write(i),this._lastColor=i),n=[].concat(n),e.stdout.write(n[0]),this._cursor[0]++,this._cursor[0]>=t[0]&&(this._cursor[0]=0,this._cursor[1]++)))},n.computeFontSize=function(){throw Error("Terminal backend has no notion of font size")},n.eventToPosition=function(t,i){return[t,i]},n.computeSize=function(){return[e.stdout.columns,e.stdout.rows]},i}(w),T=/%([bc]){([^}]*)}/g;w=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(t,i){var e={width:0,height:1};t=g(t,i);for(var n=i=0;n<t.length;n++){var r=t[n];switch(r.type){case 0:i+=r.value.length;break;case 1:e.height++,e.width=Math.max(e.width,i),i=0}}return e.width=Math.max(e.width,i),e},tokenize:g});var O={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},E={hex:C,rect:S,tile:k,term:K},A={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1},R=function(){function t(t){void 0===t&&(t={}),this._data={},this._dirty=!1,this._options={},t=Object.assign({},A,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}var i=t.prototype;return i.DEBUG=function(t,i,e){var n=[this._options.bg,this._options.fg];this.draw(t,i,null,null,n[e%n.length])},i.clear=function(){this._data={},this._dirty=!0},i.setOptions=function(t){return Object.assign(this._options,t),(t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout)&&(t.layout&&(this._backend=new E[t.layout]),this._backend.setOptions(this._options),this._dirty=!0),this},i.getOptions=function(){return this._options},i.getContainer=function(){return this._backend.getContainer()},i.computeSize=function(t,i){return this._backend.computeSize(t,i)},i.computeFontSize=function(t,i){return this._backend.computeFontSize(t,i)},i.computeTileSize=function(t,i){return[Math.floor(t/this._options.width),Math.floor(i/this._options.height)]},i.eventToPosition=function(t){if("touches"in t){var i=t.touches[0].clientX;t=t.touches[0].clientY}else i=t.clientX,t=t.clientY;return this._backend.eventToPosition(i,t)},i.draw=function(t,i,e,n,r){n||(n=this._options.fg),r||(r=this._options.bg);var o=t+","+i;this._data[o]=[t,i,e,n,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)},i.drawText=function(t,i,e,n){var r=null,o=null,s=t,a=1;for(n||(n=this._options.width-t),e=g(e,n);e.length;)switch(n=e.shift(),n.type){case 0:for(var h,c,l=!1,u=!1,_=0;_<n.value.length;_++){h=n.value.charCodeAt(_);var f=n.value.charAt(_);c=65280<h&&65377>h||65500<h&&65512>h||65518<h,h=32==f.charCodeAt(0)||12288==f.charCodeAt(0),!u||c||h||s++,c&&!l&&s++,this.draw(s++,i,f,r,o),l=h,u=c}break;case 2:r=n.value||null;break;case 3:o=n.value||null;break;case 1:s=t,i++,a++}return a},i._tick=function(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty)for(var t in this._backend.clear(),this._data)this._draw(t,!1);else for(var i in this._dirty)this._draw(i,!0);this._dirty=!1}},i._draw=function(t,i){(t=this._data[t])[4]!=this._options.bg&&(i=!0),this._backend.draw(t,i)},t}();R.Rect=S,R.Hex=C,R.Tile=k,R.Term=K,C=function(){function t(t){for(this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._suffix=this._boundary=String.fromCharCode(0),this._prefix=[],t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}var i=t.prototype;return i.clear=function(){this._data={},this._priorValues={}},i.generate=function(){for(var t=[this._sample(this._prefix)];t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))},i.observe=function(t){t=this._split(t);for(var i=0;i<t.length;i++)this._priorValues[t[i]]=this._options.prior;for(t=this._prefix.concat(t).concat(this._suffix),i=this._options.order;i<t.length;i++)for(var e=t.slice(i-this._options.order,i),n=t[i],r=0;r<e.length;r++){var o=e.slice(r);this._observeEvent(o,n)}},i.getStats=function(){var t=[],i=Object.keys(this._priorValues).length;i--,t.push("distinct samples: "+i),i=Object.keys(this._data).length;var e,n=0;for(e in this._data)n+=Object.keys(this._data[e]).length;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+n),t.join(", ")},i._split=function(t){return t.split(this._options.words?/\s+/:"")},i._join=function(t){return t.join(this._options.words?" ":"")},i._observeEvent=function(t,i){(t=this._join(t))in this._data||(this._data[t]={}),t=this._data[t],i in t||(t[i]=0),t[i]++},i._sample=function(t){t=this._backoff(t),t=this._join(t),t=this._data[t];var i={};if(this._options.prior){for(var e in this._priorValues)i[e]=this._priorValues[e];for(var n in t)i[n]+=t[n]}else i=t;return b.getWeightedValue(i)},i._backoff=function(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&0<t.length;)t=t.slice(1);return t},t}();var U=function(){function t(){this._time=0,this._events=[],this._eventTimes=[]}var i=t.prototype;return i.getTime=function(){return this._time},i.clear=function(){return this._events=[],this._eventTimes=[],this},i.add=function(t,i){for(var e=this._events.length,n=0;n<this._eventTimes.length;n++)if(this._eventTimes[n]>i){e=n;break}this._events.splice(e,0,t),this._eventTimes.splice(e,0,i)},i.get=function(){if(!this._events.length)return null;var t=this._eventTimes.splice(0,1)[0];if(0<t){this._time+=t;for(var i=0;i<this._eventTimes.length;i++)this._eventTimes[i]-=t}return this._events.splice(0,1)[0]},i.getEventTime=function(t){if(-1!=(t=this._events.indexOf(t)))return this._eventTimes[t]},i.remove=function(t){return-1!=(t=this._events.indexOf(t))&&(this._remove(t),!0)},i._remove=function(t){this._events.splice(t,1),this._eventTimes.splice(t,1)},t}();K=function(){function t(){this._queue=new U,this._repeat=[],this._current=null}var i=t.prototype;return i.getTime=function(){return this._queue.getTime()},i.add=function(t,i){return i&&this._repeat.push(t),this},i.getTimeOf=function(t){return this._queue.getEventTime(t)},i.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},i.remove=function(t){var i=this._queue.remove(t),e=this._repeat.indexOf(t);return-1!=e&&this._repeat.splice(e,1),this._current==t&&(this._current=null),i},i.next=function(){return this._current=this._queue.get()},t}(),S=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var e=i.prototype;return e.add=function(i,e){return this._queue.add(i,0),t.prototype.add.call(this,i,e)},e.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),t.prototype.next.call(this)},i}(K),k=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var e=i.prototype;return e.add=function(i,e,n){return this._queue.add(i,void 0!==n?n:1/i.getSpeed()),t.prototype.add.call(this,i,e)},e.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),t.prototype.next.call(this)},i}(K),K=function(t){function i(){var i=t.call(this)||this;return i._defaultDuration=1,i._duration=i._defaultDuration,i}s(i,t);var e=i.prototype;return e.add=function(i,e,n){return this._queue.add(i,n||this._defaultDuration),t.prototype.add.call(this,i,e)},e.clear=function(){return this._duration=this._defaultDuration,t.prototype.clear.call(this)},e.remove=function(i){return i==this._current&&(this._duration=this._defaultDuration),t.prototype.remove.call(this,i)},e.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),t.prototype.next.call(this)},e.setDuration=function(t){return this._current&&(this._duration=t),this},i}(K),S={Simple:S,Speed:k,Action:K};var I=function(){function t(t,i){void 0===i&&(i={}),this._lightPasses=t,this._options=Object.assign({topology:8},i)}return t.prototype._getCircle=function(t,i,e){var n=[];switch(this._options.topology){case 4:var r=1,o=[0,1],s=[O[8][7],O[8][1],O[8][3],O[8][5]];break;case 6:s=O[6],r=1,o=[-1,1];break;case 8:s=O[4],r=2,o=[-1,1];break;default:throw Error("Incorrect topology for FOV computation")}for(t+=o[0]*e,i+=o[1]*e,o=0;o<s.length;o++)for(var a=0;a<e*r;a++)n.push([t,i]),t+=s[o][0],i+=s[o][1];return n},t}();k=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var e=i.prototype;return e.compute=function(t,i,e,n){if(n(t,i,0,1),this._lightPasses(t,i))for(var r,o,s,a,h,c=[],l=1;l<=e;l++)for(var u=this._getCircle(t,i,l),_=360/u.length,f=0;f<u.length;f++)if(s=u[f][0],a=u[f][1],o=(r=_*(f-.5))+_,h=!this._lightPasses(s,a),this._visibleCoords(Math.floor(r),Math.ceil(o),h,c)&&n(s,a,l,1),2==c.length&&0==c[0]&&360==c[1])return},e._visibleCoords=function(t,i,e,n){if(0>t)return i=this._visibleCoords(0,i,e,n),t=this._visibleCoords(360+t,360,e,n),i||t;for(var r=0;r<n.length&&n[r]<t;)r++;if(r==n.length)return e&&n.push(t,i),!0;var o=0;if(r%2){for(;r<n.length&&n[r]<i;)r++,o++;if(0==o)return!1;e&&(o%2?n.splice(r-o,o,i):n.splice(r-o,o))}else{for(;r<n.length&&n[r]<i;)r++,o++;if(t==n[r-o]&&1==o)return!1;e&&(o%2?n.splice(r-o,o,t):n.splice(r-o,o,t,i))}return!0},i}(I),K=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var e=i.prototype;return e.compute=function(t,i,e,n){if(n(t,i,0,1),this._lightPasses(t,i))for(var r,o,s,a,h,c=[],l=1;l<=e;l++)for(var u=this._getCircle(t,i,l),_=u.length,f=0;f<_;f++)if(r=u[f][0],o=u[f][1],a=[f?2*f-1:2*_-1,2*_],h=[2*f+1,2*_],s=!this._lightPasses(r,o),(s=this._checkVisibility(a,h,s,c))&&n(r,o,l,s),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return},e._checkVisibility=function(t,i,e,n){if(t[0]>i[0])return t=this._checkVisibility(t,[t[1],t[1]],e,n),i=this._checkVisibility([0,1],i,e,n),(t+i)/2;for(var r=0,o=!1;r<n.length;){var s=n[r];if(0<=(s=s[0]*t[1]-t[0]*s[1])){0!=s||r%2||(o=!0);break}r++}s=n.length;for(var a=!1;s--;){var h=n[s];if(0<=(h=i[0]*h[1]-h[0]*i[1])){0==h&&s%2&&(a=!0);break}}if(h=!0,r==s&&(o||a)?h=!1:o&&a&&r+1==s&&s%2?h=!1:r>s&&r%2&&(h=!1),!h)return 0;if((o=s-r+1)%2)r%2?(s=n[r],s=(i[0]*s[1]-s[0]*i[1])/(s[1]*i[1]),e&&n.splice(r,o,i)):(s=((s=n[s])[0]*t[1]-t[0]*s[1])/(t[1]*s[1]),e&&n.splice(r,o,t));else{if(!(r%2))return e&&n.splice(r,o,t,i),1;a=n[r],s=((s=n[s])[0]*a[1]-a[0]*s[1])/(a[1]*s[1]),e&&n.splice(r,o)}return s/((i[0]*t[1]-t[0]*i[1])/(t[1]*i[1]))},i}(I);var L=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];I=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var e=i.prototype;return e.compute=function(t,i,e,n){n(t,i,0,1);for(var r=0;r<L.length;r++)this._renderOctant(t,i,L[r],e,n)},e.compute180=function(t,i,e,n,r){r(t,i,0,1);var o=(n-1+8)%8,s=(n+1+8)%8;this._renderOctant(t,i,L[(n-2+8)%8],e,r),this._renderOctant(t,i,L[o],e,r),this._renderOctant(t,i,L[n],e,r),this._renderOctant(t,i,L[s],e,r)},e.compute90=function(t,i,e,n,r){r(t,i,0,1);var o=(n-1+8)%8;this._renderOctant(t,i,L[n],e,r),this._renderOctant(t,i,L[o],e,r)},e._renderOctant=function(t,i,e,n,r){this._castVisibility(t,i,1,1,0,n+1,e[0],e[1],e[2],e[3],r)},e._castVisibility=function(t,i,e,n,r,o,s,a,h,c,l){if(!(n<r))for(;e<=o;e++){for(var u=-e-1,_=-e,f=!1,p=0;0>=u;){var d=t+(u+=1)*s+_*a,g=i+u*h+_*c,v=(u-.5)/(_+.5),m=(u+.5)/(_-.5);if(!(m>n)){if(v<r)break;u*u+_*_<o*o&&l(d,g,e,1),f?this._lightPasses(d,g)?(f=!1,n=p):p=m:!this._lightPasses(d,g)&&e<o&&(f=!0,this._castVisibility(t,i,e+1,n,v,o,s,a,h,c,l),p=m)}}if(f)break}},i}(I),k={DiscreteShadowcasting:k,PreciseShadowcasting:K,RecursiveShadowcasting:I},I=function(){function t(t,i){void 0===t&&(t=80),void 0===i&&(i=25),this._width=t,this._height=i}return t.prototype._fillMap=function(t){for(var i=[],e=0;e<this._width;e++){i.push([]);for(var n=0;n<this._height;n++)i[e].push(t)}return i},t}(),K=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.create=function(t){for(var i=this._width-1,e=this._height-1,n=0;n<=i;n++)for(var r=0;r<=e;r++)t(n,r,n&&r&&n<i&&r<e?0:1);return this},i}(I);var P=function(t){function i(i,e){return(i=t.call(this,i,e)||this)._rooms=[],i._corridors=[],i}s(i,t);var e=i.prototype;return e.getRooms=function(){return this._rooms},e.getCorridors=function(){return this._corridors},i}(I),D=function(){},N=function(t){function i(i,e,n,r,o,s){var a=t.call(this)||this;return a._x1=i,a._y1=e,a._x2=n,a._y2=r,a._doors={},void 0!==o&&void 0!==s&&a.addDoor(o,s),a}s(i,t),i.createRandomAt=function(t,i,e,n,r){var o=r.roomWidth[0],s=r.roomWidth[1],a=b.getUniformInt(o,s);if(o=r.roomHeight[0],s=r.roomHeight[1],r=b.getUniformInt(o,s),1==e)return e=i-Math.floor(b.getUniform()*r),new this(t+1,e,t+a,e+r-1,t,i);if(-1==e)return e=i-Math.floor(b.getUniform()*r),new this(t-a,e,t-1,e+r-1,t,i);if(1==n)return new this(e=t-Math.floor(b.getUniform()*a),i+1,e+a-1,i+r,t,i);if(-1==n)return new this(e=t-Math.floor(b.getUniform()*a),i-r,e+a-1,i-1,t,i);throw Error("dx or dy must be 1 or -1")},i.createRandomCenter=function(t,i,e){var n=e.roomWidth[0],r=e.roomWidth[1],o=b.getUniformInt(n,r);return n=e.roomHeight[0],r=e.roomHeight[1],e=b.getUniformInt(n,r),t-=Math.floor(b.getUniform()*o),i-=Math.floor(b.getUniform()*e),new this(t,i,t+o-1,i+e-1)},i.createRandom=function(t,i,e){var n=e.roomWidth[0],r=e.roomWidth[1],o=b.getUniformInt(n,r);return n=e.roomHeight[0],r=e.roomHeight[1],e=b.getUniformInt(n,r),t=t-o-1,i=i-e-1,t=1+Math.floor(b.getUniform()*t),i=1+Math.floor(b.getUniform()*i),new this(t,i,t+o-1,i+e-1)};var e=i.prototype;return e.addDoor=function(t,i){return this._doors[t+","+i]=1,this},e.getDoors=function(t){for(var i in this._doors){var e=i.split(",");t(parseInt(e[0]),parseInt(e[1]))}return this},e.clearDoors=function(){return this._doors={},this},e.addDoors=function(t){for(var i=this._x1-1,e=this._x2+1,n=this._y1-1,r=this._y2+1,o=i;o<=e;o++)for(var s=n;s<=r;s++)o!=i&&o!=e&&s!=n&&s!=r||t(o,s)||this.addDoor(o,s);return this},e.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},e.isValid=function(t,i){for(var e=this._x1-1,n=this._x2+1,r=this._y1-1,o=this._y2+1,s=e;s<=n;s++)for(var a=r;a<=o;a++)if(s==e||s==n||a==r||a==o){if(!t(s,a))return!1}else if(!i(s,a))return!1;return!0},e.create=function(t){for(var i,e=this._x1-1,n=this._x2+1,r=this._y1-1,o=this._y2+1,s=e;s<=n;s++)for(var a=r;a<=o;a++)i=s+","+a in this._doors?2:s==e||s==n||a==r||a==o?1:0,t(s,a,i)},e.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},e.getLeft=function(){return this._x1},e.getRight=function(){return this._x2},e.getTop=function(){return this._y1},e.getBottom=function(){return this._y2},i}(D),W=function(t){function i(i,e,n,r){var o=t.call(this)||this;return o._startX=i,o._startY=e,o._endX=n,o._endY=r,o._endsWithAWall=!0,o}s(i,t),i.createRandomAt=function(t,i,e,n,r){return r=b.getUniformInt(r.corridorLength[0],r.corridorLength[1]),new this(t,i,t+e*r,i+n*r)};var e=i.prototype;return e.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},e.isValid=function(t,i){var e=this._startX,n=this._startY,r=this._endX-e,o=this._endY-n,s=1+Math.max(Math.abs(r),Math.abs(o));r&&(r/=Math.abs(r)),o&&(o/=Math.abs(o));for(var a=o,h=-r,c=!0,l=0;l<s;l++){var u=e+l*r,_=n+l*o;if(i(u,_)||(c=!1),t(u+a,_+h)||(c=!1),t(u-a,_-h)||(c=!1),!c){s=l,this._endX=u-r,this._endY=_-o;break}}return!(0==s||1==s&&t(this._endX+r,this._endY+o)||(i=!t(this._endX+r+a,this._endY+o+h),a=!t(this._endX+r-a,this._endY+o-h),this._endsWithAWall=t(this._endX+r,this._endY+o),(i||a)&&this._endsWithAWall))},e.create=function(t){var i=this._startX,e=this._startY,n=this._endX-i,r=this._endY-e,o=1+Math.max(Math.abs(n),Math.abs(r));n&&(n/=Math.abs(n)),r&&(r/=Math.abs(r));for(var s=0;s<o;s++)t(i+s*n,e+s*r,0);return!0},e.createPriorityWalls=function(t){if(this._endsWithAWall){var i=this._endX-this._startX,e=this._endY-this._startY;i&&(i/=Math.abs(i)),e&&(e/=Math.abs(e));var n=e,r=-i;t(this._endX+i,this._endY+e),t(this._endX+n,this._endY+r),t(this._endX-n,this._endY-r)}},i}(D);D=function(t){function i(i,e,n){return(i=t.call(this,i,e)||this)._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(i._options,n),i._map=[],i._dug=0,i._roomAttempts=20,i._corridorAttempts=20,i._connected=[],i._unconnected=[],i._digCallback=i._digCallback.bind(o(o(i))),i._canBeDugCallback=i._canBeDugCallback.bind(o(o(i))),i._isWallCallback=i._isWallCallback.bind(o(o(i))),i}s(i,t);var e=i.prototype;return e.create=function(t){for(var i=Date.now();;){if(Date.now()-i>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(2>this._rooms.length)&&this._generateCorridors())break}if(t)for(i=0;i<this._width;i++)for(var e=0;e<this._height;e++)t(i,e,this._map[i][e]);return this},e._generateRooms=function(){var t=this._width-2,i=this._height-2;do{var e=this._generateRoom();if(this._dug/(t*i)>this._options.roomDugPercentage)break}while(e)},e._generateRoom=function(){for(var t=0;t<this._roomAttempts;){t++;var i=N.createRandom(this._width,this._height,this._options);if(i.isValid(this._isWallCallback,this._canBeDugCallback))return i.create(this._digCallback),this._rooms.push(i),i}return null},e._generateCorridors=function(){for(var t=0;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(var i=0;i<this._rooms.length;i++){var e=this._rooms[i];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=b.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());(i=b.getItem(this._connected))&&(i=this._closestRoom(this._unconnected,i))&&(e=this._closestRoom(this._connected,i))&&this._connectRooms(i,e);)if(!this._unconnected.length)return!0}return!1},e._closestRoom=function(t,i){var e=1/0;i=i.getCenter();for(var n=null,r=0;r<t.length;r++){var o=t[r],s=o.getCenter(),a=s[0]-i[0];s=s[1]-i[1],(a=a*a+s*s)<e&&(e=a,n=o)}return n},e._connectRooms=function(t,i){var e=t.getCenter(),n=i.getCenter(),r=n[0]-e[0];if(e=n[1]-e[1],Math.abs(r)<Math.abs(e)){var o=(2+(r=0<e?2:0))%4,s=i.getLeft(),a=i.getRight();e=0}else o=(2+(r=0<r?1:3))%4,s=i.getTop(),a=i.getBottom(),e=1;if(!(r=this._placeInWall(t,r)))return!1;if(r[e]>=s&&r[e]<=a){switch(n=r.slice(),s=0,o){case 0:s=i.getTop()-1;break;case 1:s=i.getRight()+1;break;case 2:s=i.getBottom()+1;break;case 3:s=i.getLeft()-1}n[(e+1)%2]=s,this._digLine([r,n])}else if(r[e]<s-1||r[e]>a+1){switch(n=r[e]-n[e],s=0,o){case 0:case 1:s=0>n?3:1;break;case 2:case 3:s=0>n?1:3}if(!(n=this._placeInWall(i,(o+s)%4)))return!1;(o=[0,0])[e]=r[e],o[e=(e+1)%2]=n[e],this._digLine([r,o,n])}else{if(s=(e+1)%2,!(n=this._placeInWall(i,o)))return!1;o=Math.round((n[s]+r[s])/2);var h=[0,0];(a=[0,0])[e]=r[e],a[s]=o,h[e]=n[e],h[s]=o,this._digLine([r,a,h,n])}return t.addDoor(r[0],r[1]),i.addDoor(n[0],n[1]),-1!=(e=this._unconnected.indexOf(t))&&(this._unconnected.splice(e,1),this._connected.push(t)),-1!=(e=this._unconnected.indexOf(i))&&(this._unconnected.splice(e,1),this._connected.push(i)),!0},e._placeInWall=function(t,i){var e=[0,0],n=[0,0],r=0;switch(i){case 0:n=[1,0],e=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:n=[0,1],e=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:n=[1,0],e=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:n=[0,1],e=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1}t=[],i=-2;for(var o=0;o<r;o++){var s=e[0]+o*n[0],a=e[1]+o*n[1];t.push(null),1==this._map[s][a]?i!=o-1&&(t[o]=[s,a]):(i=o)&&(t[o-1]=null)}for(e=t.length-1;0<=e;e--)t[e]||t.splice(e,1);return t.length?b.getItem(t):null},e._digLine=function(t){for(var i=1;i<t.length;i++){var e=t[i-1],n=t[i];(e=new W(e[0],e[1],n[0],n[1])).create(this._digCallback),this._corridors.push(e)}},e._digCallback=function(t,i,e){this._map[t][i]=e,0==e&&this._dug++},e._isWallCallback=function(t,i){return!(0>t||0>i||t>=this._width||i>=this._height)&&1==this._map[t][i]},e._canBeDugCallback=function(t,i){return!(1>t||1>i||t+1>=this._width||i+1>=this._height)&&1==this._map[t][i]},i}(P);var j=function(t){function i(i,e,n){return void 0===n&&(n={}),(i=t.call(this,i,e)||this)._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},i.setOptions(n),i._dirs=O[i._options.topology],i._map=i._fillMap(0),i}s(i,t);var e=i.prototype;return e.randomize=function(t){for(var i=0;i<this._width;i++)for(var e=0;e<this._height;e++)this._map[i][e]=b.getUniform()<t?1:0;return this},e.setOptions=function(t){Object.assign(this._options,t)},e.set=function(t,i,e){this._map[t][i]=e},e.create=function(t){for(var i=this._fillMap(0),e=this._options.born,n=this._options.survive,r=0;r<this._height;r++){var o=1,s=0;for(6==this._options.topology&&(o=2,s=r%2);s<this._width;s+=o){var a=this._map[s][r],h=this._getNeighbors(s,r);a&&-1!=n.indexOf(h)?i[s][r]=1:a||-1==e.indexOf(h)||(i[s][r]=1)}}this._map=i,t&&this._serviceCallback(t)},e._serviceCallback=function(t){for(var i=0;i<this._height;i++){var e=1,n=0;for(6==this._options.topology&&(e=2,n=i%2);n<this._width;n+=e)t(n,i,this._map[n][i])}},e._getNeighbors=function(t,i){for(var e=0,n=0;n<this._dirs.length;n++){var r=this._dirs[n],o=t+r[0];r=i+r[1],0>o||o>=this._width||0>r||r>=this._height||(e+=1==this._map[o][r]?1:0)}return e},e.connect=function(t,i,e){i||(i=0);var n=[],r={},o=1,s=[0,0];6==this._options.topology&&(o=2,s=[0,1]);for(var a=0;a<this._height;a++)for(var h=s[a%2];h<this._width;h+=o)if(this._freeSpace(h,a,i)){var c=[h,a];r[this._pointKey(c)]=c,n.push([h,a])}for(o=n[b.getUniformInt(0,n.length-1)],s=this._pointKey(o),(n={})[s]=o,delete r[s],this._findConnected(n,r,[o],!1,i);0<Object.keys(r).length;)for(var l in s=this._getFromTo(n,r),o=s[0],a=s[1],(s={})[this._pointKey(o)]=o,this._findConnected(s,r,[o],!0,i),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,a,o,n,r,i,e),s)o=s[l],this._map[o[0]][o[1]]=i,n[l]=o,delete r[l];t&&this._serviceCallback(t)},e._getFromTo=function(t,i){for(var e=[0,0],n=[0,0],r=Object.keys(t),o=Object.keys(i),s=0;5>s&&(r.length<o.length?(n=t[(e=r)[b.getUniformInt(0,e.length-1)]],e=this._getClosest(n,i)):(e=i[(e=o)[b.getUniformInt(0,e.length-1)]],n=this._getClosest(e,t)),!(64>(e[0]-n[0])*(e[0]-n[0])+(e[1]-n[1])*(e[1]-n[1])));s++);return[e,n]},e._getClosest=function(t,i){var e,n=null,r=null;for(e in i){var o=i[e],s=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==r||s<r)&&(r=s,n=o)}return n},e._findConnected=function(t,i,e,n,r){for(;0<e.length;){var o=e.splice(0,1)[0];o=6==this._options.topology?[[o[0]+2,o[1]],[o[0]+1,o[1]-1],[o[0]-1,o[1]-1],[o[0]-2,o[1]],[o[0]-1,o[1]+1],[o[0]+1,o[1]+1]]:[[o[0]+1,o[1]],[o[0]-1,o[1]],[o[0],o[1]+1],[o[0],o[1]-1]];for(var s=0;s<o.length;s++){var a=this._pointKey(o[s]);null==t[a]&&this._freeSpace(o[s][0],o[s][1],r)&&(t[a]=o[s],n||delete i[a],e.push(o[s]))}}},e._tunnelToConnected=function(t,i,e,n,r,o){if(i[0]<t[0])var s=i,a=t;else s=t,a=i;for(var h=s[0];h<=a[0];h++){this._map[h][s[1]]=r;var c=[h,s[1]],l=this._pointKey(c);e[l]=c,delete n[l]}for(o&&s[0]<a[0]&&o(s,[a[0],s[1]]),h=a[0],i[1]<t[1]?(s=i,a=t):(s=t,a=i),t=s[1];t<a[1];t++)this._map[h][t]=r,i=[h,t],c=this._pointKey(i),e[c]=i,delete n[c];o&&s[1]<a[1]&&o([a[0],s[1]],[a[0],a[1]])},e._tunnelToConnected6=function(t,i,e,n,r,o){if(i[0]<t[0])var s=i,a=t;else s=t,a=i;var h=s[0];for(s=s[1];h!=a[0]||s!=a[1];){var c=2;s<a[1]?(s++,c=1):s>a[1]&&(s--,c=1),h=h<a[0]?h+c:h>a[0]?h-c:a[1]%2?h-c:h+c,this._map[h][s]=r,c=[h,s];var l=this._pointKey(c);e[l]=c,delete n[l]}o&&o(i,t)},e._freeSpace=function(t,i,e){return 0<=t&&t<this._width&&0<=i&&i<this._height&&this._map[t][i]==e},e._pointKey=function(t){return t[0]+"."+t[1]},i}(I),F={room:N,corridor:W};P=function(t){function i(i,e,n){return void 0===n&&(n={}),(i=t.call(this,i,e)||this)._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),i._features={room:4,corridor:4},i._map=[],i._featureAttempts=20,i._walls={},i._dug=0,i._digCallback=i._digCallback.bind(o(o(i))),i._canBeDugCallback=i._canBeDugCallback.bind(o(o(i))),i._isWallCallback=i._isWallCallback.bind(o(o(i))),i._priorityWallCallback=i._priorityWallCallback.bind(o(o(i))),i}s(i,t);var e=i.prototype;return e.create=function(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var i=(this._width-2)*(this._height-2);this._firstRoom();var e=Date.now();do{var n=0;if(Date.now()-e>this._options.timeLimit)break;var r=this._findWall();if(!r)break;var o=r.split(",");r=parseInt(o[0]),o=parseInt(o[1]);var s=this._getDiggingDirection(r,o);if(s){var a=0;do{if(a++,this._tryFeature(r,o,s[0],s[1])){this._removeSurroundingWalls(r,o),this._removeSurroundingWalls(r-s[0],o-s[1]);break}}while(a<this._featureAttempts);for(var h in this._walls)1<this._walls[h]&&n++}}while(this._dug/i<this._options.dugPercentage||n);if(this._addDoors(),t)for(i=0;i<this._width;i++)for(e=0;e<this._height;e++)t(i,e,this._map[i][e]);return this._walls={},this._map=[],this},e._digCallback=function(t,i,e){0==e||2==e?(this._map[t][i]=0,this._dug++):this._walls[t+","+i]=1},e._isWallCallback=function(t,i){return!(0>t||0>i||t>=this._width||i>=this._height)&&1==this._map[t][i]},e._canBeDugCallback=function(t,i){return!(1>t||1>i||t+1>=this._width||i+1>=this._height)&&1==this._map[t][i]},e._priorityWallCallback=function(t,i){this._walls[t+","+i]=2},e._firstRoom=function(){var t=N.createRandomCenter(Math.floor(this._width/2),Math.floor(this._height/2),this._options);this._rooms.push(t),t.create(this._digCallback)},e._findWall=function(){var t,i=[],e=[];for(t in this._walls)2==this._walls[t]?e.push(t):i.push(t);return(i=e.length?e:i).length?(i=b.getItem(i.sort()),delete this._walls[i],i):null},e._tryFeature=function(t,i,e,n){var r=b.getWeightedValue(this._features);return!!(t=F[r].createRandomAt(t,i,e,n,this._options)).isValid(this._isWallCallback,this._canBeDugCallback)&&(t.create(this._digCallback),t instanceof N&&this._rooms.push(t),t instanceof W&&(t.createPriorityWalls(this._priorityWallCallback),this._corridors.push(t)),!0)},e._removeSurroundingWalls=function(t,i){for(var e=O[4],n=0;n<e.length;n++){var r=e[n],o=t+r[0],s=i+r[1];delete this._walls[o+","+s],o=t+2*r[0],s=i+2*r[1],delete this._walls[o+","+s]}},e._getDiggingDirection=function(t,i){if(0>=t||0>=i||t>=this._width-1||i>=this._height-1)return null;for(var e=null,n=O[4],r=0;r<n.length;r++){var o=n[r];if(!this._map[t+o[0]][i+o[1]]){if(e)return null;e=o}}return e?[-e[0],-e[1]]:null},e._addDoors=function(){function t(t,e){return 1==i[t][e]}for(var i=this._map,e=0;e<this._rooms.length;e++){var n=this._rooms[e];n.clearDoors(),n.addDoors(t)}},i}(P);var X=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.create=function(t){for(var i=this._fillMap(1),e=Math.ceil((this._width-2)/2),n=[],r=[],o=0;o<e;o++)n.push(o),r.push(o);for(n.push(e-1),o=1;o+3<this._height;o+=2)for(var s=0;s<e;s++){var a=2*s+1,h=o;i[a][h]=0,s!=n[s+1]&&.375<b.getUniform()&&(m(s,n,r),i[a+1][h]=0),s!=n[s]&&.375<b.getUniform()?y(s,n,r):i[a][h+1]=0}for(s=0;s<e;s++)h=o,i[a=2*s+1][h]=0,s!=n[s+1]&&(s==n[s]||.375<b.getUniform())&&(m(s,n,r),i[a+1][h]=0),y(s,n,r);for(e=0;e<this._width;e++)for(n=0;n<this._height;n++)t(e,n,i[e][n]);return this},i}(I),z=function(t){function i(){var i=t.apply(this,arguments)||this;return i._stack=[],i._map=[],i}s(i,t);var e=i.prototype;return e.create=function(t){var i=this._width,e=this._height;this._map=[];for(var n=0;n<i;n++){this._map.push([]);for(var r=0;r<e;r++)this._map[n].push(0==n||0==r||n+1==i||r+1==e?1:0)}for(this._stack=[[1,1,i-2,e-2]],this._process(),n=0;n<i;n++)for(r=0;r<e;r++)t(n,r,this._map[n][r]);return this._map=[],this},e._process=function(){for(;this._stack.length;){var t=this._stack.shift();this._partitionRoom(t)}},e._partitionRoom=function(t){for(var i=[],e=[],n=t[0]+1;n<t[2];n++){var r=this._map[n][t[3]+1];!this._map[n][t[1]-1]||!r||n%2||i.push(n)}for(n=t[1]+1;n<t[3];n++)r=this._map[t[2]+1][n],!this._map[t[0]-1][n]||!r||n%2||e.push(n);if(i.length&&e.length){i=b.getItem(i),e=b.getItem(e),this._map[i][e]=1,(n=[]).push(r=[]);for(var o=t[0];o<i;o++)this._map[o][e]=1,r.push([o,e]);for(r=[],n.push(r),o=i+1;o<=t[2];o++)this._map[o][e]=1,r.push([o,e]);for(r=[],n.push(r),o=t[1];o<e;o++)this._map[i][o]=1,r.push([i,o]);for(r=[],n.push(r),o=e+1;o<=t[3];o++)this._map[i][o]=1,r.push([i,o]);for(r=b.getItem(n),o=0;o<n.length;o++){var s=n[o];s!=r&&(s=b.getItem(s),this._map[s[0]][s[1]]=0)}this._stack.push([t[0],t[1],i-1,e-1]),this._stack.push([i+1,t[1],t[2],e-1]),this._stack.push([t[0],e+1,i-1,t[3]]),this._stack.push([i+1,e+1,t[2],t[3]])}},i}(I),Y=function(t){function i(i,e,n){return void 0===n&&(n=0),(i=t.call(this,i,e)||this)._regularity=n,i._map=[],i}s(i,t);var e=i.prototype;return e.create=function(t){var i=this._width,e=this._height,n=this._fillMap(1);i-=i%2?1:2,e-=e%2?1:2;var r=0,o=[[0,0],[0,0],[0,0],[0,0]];do{var s=1+2*Math.floor(b.getUniform()*(i-1)/2),a=1+2*Math.floor(b.getUniform()*(e-1)/2);if(r||(n[s][a]=0),!n[s][a]){this._randomize(o);do{0==Math.floor(b.getUniform()*(this._regularity+1))&&this._randomize(o);for(var h=!0,c=0;4>c;c++){var l=s+2*o[c][0],u=a+2*o[c][1];if(this._isFree(n,l,u,i,e)){n[l][u]=0,n[s+o[c][0]][a+o[c][1]]=0,s=l,a=u,h=!1,r++;break}}}while(!h)}}while(r+1<i*e/4);for(i=0;i<this._width;i++)for(e=0;e<this._height;e++)t(i,e,n[i][e]);return this._map=[],this},e._randomize=function(t){for(var i=0;4>i;i++)t[i][0]=0,t[i][1]=0;switch(Math.floor(4*b.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}},e._isFree=function(t,i,e,n,r){return!(1>i||1>e||i>=n||e>=r)&&t[i][e]},i}(I);I=function(t){function i(i,e,n){return(i=t.call(this,i,e)||this).map=[],i.rooms=[],i.connectedCells=[],(n=Object.assign({cellWidth:3,cellHeight:3},n)).hasOwnProperty("roomWidth")||(n.roomWidth=i._calculateRoomSize(i._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=i._calculateRoomSize(i._height,n.cellHeight)),i._options=n,i}s(i,t);var e=i.prototype;return e.create=function(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(var i=0;i<this._width;i++)for(var e=0;e<this._height;e++)t(i,e,this.map[i][e]);return this},e._calculateRoomSize=function(t,i){var e=Math.floor(t/i*.8);return 2>(t=Math.floor(t/i*.25))&&(t=2),2>e&&(e=2),[t,e]},e._initRooms=function(){for(var t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(var i=0;i<this._options.cellHeight;i++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:i})}},e._connectRooms=function(){var t=b.getUniformInt(0,this._options.cellWidth-1),i=b.getUniformInt(0,this._options.cellHeight-1);do{var e=[0,2,4,6];e=b.shuffle(e);do{var n=!1,r=e.pop(),o=t+O[8][r][0];if(r=i+O[8][r][1],!(0>o||o>=this._options.cellWidth||0>r||r>=this._options.cellHeight)){var s=this.rooms[t][i];if(0<s.connections.length&&s.connections[0][0]==o&&s.connections[0][1]==r)break;0==(s=this.rooms[o][r]).connections.length&&(s.connections.push([t,i]),this.connectedCells.push([o,r]),t=o,i=r,n=!0)}}while(0<e.length&&0==n)}while(0<e.length)},e._connectUnconnectedRooms=function(){var t=this._options.cellWidth,i=this._options.cellHeight;this.connectedCells=b.shuffle(this.connectedCells);for(var e,n,r,o=0;o<this._options.cellWidth;o++)for(var s=0;s<this._options.cellHeight;s++)if(0==(e=this.rooms[o][s]).connections.length){var a=[0,2,4,6];a=b.shuffle(a),r=!1;do{var h=a.pop(),c=o+O[8][h][0];if(h=s+O[8][h][1],!(0>c||c>=t||0>h||h>=i)){if(n=this.rooms[c][h],r=!0,0==n.connections.length)break;for(c=0;c<n.connections.length;c++)if(n.connections[c][0]==o&&n.connections[c][1]==s){r=!1;break}if(r)break}}while(a.length);r?e.connections.push([n.cellx,n.celly]):console.log("-- Unable to connect room.")}},e._createRandomRoomConnections=function(){},e._createRooms=function(){for(var t,i,e,n,r,o=this._width,s=this._height,a=this._options.cellWidth,h=this._options.cellHeight,c=Math.floor(this._width/a),l=Math.floor(this._height/h),u=this._options.roomWidth,_=this._options.roomHeight,f=0;f<a;f++)for(var p=0;p<h;p++){if(0==(e=c*f)&&(e=1),0==(n=l*p)&&(n=1),t=b.getUniformInt(u[0],u[1]),i=b.getUniformInt(_[0],_[1]),0<p)for(r=this.rooms[f][p-1];3>n-(r.y+r.height);)n++;if(0<f)for(r=this.rooms[f-1][p];3>e-(r.x+r.width);)e++;r=Math.round(b.getUniformInt(0,c-t)/2);for(var d=Math.round(b.getUniformInt(0,l-i)/2);e+r+t>=o;)r?r--:t--;for(;n+d+i>=s;)d?d--:i--;for(e+=r,n+=d,this.rooms[f][p].x=e,this.rooms[f][p].y=n,this.rooms[f][p].width=t,this.rooms[f][p].height=i,r=e;r<e+t;r++)for(d=n;d<n+i;d++)this.map[r][d]=0}},e._getWallPosition=function(t,i){if(1==i||3==i){var e=b.getUniformInt(t.x+1,t.x+t.width-2);if(1==i){var n=t.y-2;t=n+1}else n=t.y+t.height+1,t=n-1;this.map[e][t]=0}else n=b.getUniformInt(t.y+1,t.y+t.height-2),2==i?(e=t.x+t.width+1,t=e-1):(e=t.x-2,t=e+1),this.map[t][n]=0;return[e,n]},e._drawCorridor=function(t,i){var e=i[0]-t[0],n=i[1]-t[1];i=t[0],t=t[1];var r=[],o=Math.abs(e),s=Math.abs(n),a=b.getUniform(),h=1-a;for(e=0<e?2:6,n=0<n?4:0,o<s?(a=Math.ceil(s*a),r.push([n,a]),r.push([e,o]),a=Math.floor(s*h),r.push([n,a])):(a=Math.ceil(o*a),r.push([e,a]),r.push([n,s]),a=Math.floor(o*h),r.push([e,a])),this.map[i][t]=0;0<r.length;)for(o=r.pop();0<o[1];)i+=O[8][o[0]][0],t+=O[8][o[0]][1],this.map[i][t]=0,--o[1]},e._createCorridors=function(){for(var t,i,e,n,r=this._options.cellWidth,o=this._options.cellHeight,s=0;s<r;s++)for(var a=0;a<o;a++){t=this.rooms[s][a];for(var h=0;h<t.connections.length;h++)i=t.connections[h],(i=this.rooms[i[0]][i[1]]).cellx>t.cellx?(e=2,n=4):i.cellx<t.cellx?(e=4,n=2):i.celly>t.celly?(e=3,n=1):(e=1,n=3),this._drawCorridor(this._getWallPosition(t,e),this._getWallPosition(i,n))}},i}(I),K={Arena:K,Uniform:D,Cellular:j,Digger:P,EllerMaze:X,DividedMaze:z,IceyMaze:Y,Rogue:I};var H=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6;I={Simplex:function(t){function e(i){void 0===i&&(i=256);var e=t.call(this)||this;e._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var n=[],r=0;r<i;r++)n.push(r);for(n=b.shuffle(n),e._perms=[],e._indexes=[],r=0;r<2*i;r++)e._perms.push(n[r%i]),e._indexes.push(e._perms[r]%e._gradients.length);return e}return s(e,t),e.prototype.get=function(t,e){var n=this._perms,r=this._indexes,o=n.length/2,s=0,a=0,h=0,c=(t+e)*H,l=Math.floor(t+c),u=Math.floor(e+c),_=(l+u)*B,f=e-(u-_);if((c=t-(l-_))>f)var p=1,d=0;else p=0,d=1;_=c-p+B;var g=f-d+B;e=c-1+2*B,t=f-1+2*B,l=i(l,o),o=i(u,o);var v=.5-c*c-f*f;return 0<=v&&(v*=v,u=r[l+n[o]],s=this._gradients[u],s=v*v*(s[0]*c+s[1]*f)),0<=(c=.5-_*_-g*g)&&(c*=c,u=r[l+p+n[o+d]],a=this._gradients[u],a=c*c*(a[0]*_+a[1]*g)),0<=(c=.5-e*e-t*t)&&(c*=c,u=r[l+1+n[o+1]],n=this._gradients[u],h=c*c*(n[0]*e+n[1]*t)),70*(s+a+h)},e}(function(){})},j=function(){function t(t,i,e,n){void 0===n&&(n={}),this._toX=t,this._toY=i,this._passableCallback=e,this._options=Object.assign({topology:8},n),this._dirs=O[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}return t.prototype._getNeighbors=function(t,i){for(var e=[],n=0;n<this._dirs.length;n++){var r=this._dirs[n],o=t+r[0];r=i+r[1],this._passableCallback(o,r)&&e.push([o,r])}return e},t}(),D=function(t){function i(i,e,n,r){return(n=t.call(this,i,e,n,r)||this)._computed={},n._todo=[],n._add(i,e,null),n}s(i,t);var e=i.prototype;return e.compute=function(t,i,e){var n=t+","+i;if(n in this._computed||this._compute(t,i),n in this._computed)for(t=this._computed[n];t;)e(t.x,t.y),t=t.prev},e._compute=function(t,i){for(;this._todo.length;){var e=this._todo.shift();if(e.x==t&&e.y==i)break;for(var n=this._getNeighbors(e.x,e.y),r=0;r<n.length;r++){var o=n[r],s=o[0];o=o[1],s+","+o in this._computed||this._add(s,o,e)}}},e._add=function(t,i,e){e={x:t,y:i,prev:e},this._computed[t+","+i]=e,this._todo.push(e)},i}(j),j=function(t){function i(i,e,n,r){return void 0===r&&(r={}),(i=t.call(this,i,e,n,r)||this)._todo=[],i._done={},i}s(i,t);var e=i.prototype;return e.compute=function(t,i,e){for(this._todo=[],this._done={},this._fromX=t,this._fromY=i,this._add(this._toX,this._toY,null);this._todo.length;){var n=this._todo.shift(),r=n.x+","+n.y;if(!(r in this._done)){if(this._done[r]=n,n.x==t&&n.y==i)break;r=this._getNeighbors(n.x,n.y);for(var o=0;o<r.length;o++){var s=r[o],a=s[0];s=s[1],a+","+s in this._done||this._add(a,s,n)}}}if(t=this._done[t+","+i])for(;t;)e(t.x,t.y),t=t.prev},e._add=function(t,i,e){var n=this._distance(t,i);for(t={x:t,y:i,prev:e,g:e?e.g+1:0,h:n},i=t.g+t.h,e=0;e<this._todo.length;e++){var r=this._todo[e],o=r.g+r.h;if(i<o||i==o&&n<r.h)return void this._todo.splice(e,0,t)}this._todo.push(t)},e._distance=function(t,i){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(i-this._fromY);case 6:return(i=Math.abs(i-this._fromY))+Math.max(0,(Math.abs(t-this._fromX)-i)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(i-this._fromY))}},i}(j),D={Dijkstra:D,AStar:j},j=function(){function t(t){this._scheduler=t,this._lock=1}var i=t.prototype;return i.start=function(){return this.unlock()},i.lock=function(){return this._lock++,this},i.unlock=function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var t=this._scheduler.next();if(!t)return this.lock();(t=t.act())&&t.then&&(this.lock(),t.then(this.unlock.bind(this)))}return this},t}(),P=function(){function t(t,i){void 0===i&&(i={}),this._reflectivityCallback=t,this._options={},i=Object.assign({passes:1,emissionThreshold:100,range:10},i),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(i)}var i=t.prototype;return i.setOptions=function(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this},i.setFOV=function(t){return this._fov=t,this._fovCache={},this},i.setLight=function(t,i,e){return t=t+","+i,e?this._lights[t]="string"==typeof e?h(e):e:delete this._lights[t],this},i.clearLights=function(){this._lights={}},i.reset=function(){return this._reflectivityCache={},this._fovCache={},this},i.compute=function(t){var i,e={},n={},r={};for(i in this._lights){var o=this._lights[i];n[i]=[0,0,0],c(n[i],o)}for(i=0;i<this._options.passes;i++)this._emitLight(n,r,e),i+1!=this._options.passes&&(n=this._computeEmitters(r,e));for(var s in r)n=s.split(","),e=parseInt(n[0]),n=parseInt(n[1]),t(e,n,r[s]);return this},i._emitLight=function(t,i,e){for(var n in t){var r=n.split(","),o=parseInt(r[0]);r=parseInt(r[1]),this._emitLightFromCell(o,r,t[n],i),e[n]=1}return this},i._computeEmitters=function(t,i){var e,n={};for(e in t)if(!(e in i)){var r=t[e];if(e in this._reflectivityCache)var o=this._reflectivityCache[e];else{var s=e.split(",");o=parseInt(s[0]),s=parseInt(s[1]),o=this._reflectivityCallback(o,s),this._reflectivityCache[e]=o}if(0!=o){s=[0,0,0];for(var a=0,h=0;3>h;h++){var c=Math.round(r[h]*o);s[h]=c,a+=c}a>this._options.emissionThreshold&&(n[e]=s)}}return n},i._emitLightFromCell=function(t,i,e,n){var r=t+","+i;for(var o in t=r in this._fovCache?this._fovCache[r]:this._updateFOV(t,i)){i=t[o],o in n?r=n[o]:(r=[0,0,0],n[o]=r);for(var s=0;3>s;s++)r[s]+=Math.round(e[s]*i)}return this},i._updateFOV=function(t,i){var e={};this._fovCache[t+","+i]=e;var n=this._options.range;return this._fov.compute(t,i,n,function(t,i,r,o){0!=(r=o*(1-r/n))&&(e[t+","+i]=r)}.bind(this)),e},t}(),t.Util=M,t.Color=x,t.Text=w,t.RNG=b,t.Display=R,t.StringGenerator=C,t.EventQueue=U,t.Scheduler=S,t.FOV=k,t.Map=K,t.Noise=I,t.Path=D,t.Engine=j,t.Lighting=P,t.DEFAULT_WIDTH=80,t.DEFAULT_HEIGHT=25,t.DIRS=O,t.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},Object.defineProperty(t,"__esModule",{value:!0})}(i)}).call(this,e(1),e(2))},function(t,i){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,i){var e,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var h,c=[],l=!1,u=-1;function _(){l&&h&&(l=!1,h.length?c=h.concat(c):u=-1,c.length&&f())}function f(){if(!l){var t=a(_);l=!0;for(var i=c.length;i;){for(h=c,c=[];++u<i;)h&&h[u].run();u=-1,i=c.length}h=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(i){try{return n.call(null,t)}catch(i){return n.call(this,t)}}}(t)}}function p(t,i){this.fun=t,this.array=i}function d(){}r.nextTick=function(t){var i=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)i[e-1]=arguments[e];c.push(new p(t,i)),1!==c.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,i,e){var n=e(4);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e(6)(n,r);n.locals&&(t.exports=n.locals)},function(t,i,e){(t.exports=e(5)(!1)).push([t.i,"body {\n  background-color: black; }\n",""])},function(t,i,e){"use strict";t.exports=function(t){var i=[];return i.toString=function(){return this.map(function(i){var e=function(t,i){var e=t[1]||"",n=t[3];if(!n)return e;if(i&&"function"==typeof btoa){var r=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[e].concat(o).concat([r]).join("\n")}var s;return[e].join("\n")}(i,t);return i[2]?"@media "+i[2]+"{"+e+"}":e}).join("")},i.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},r=0;r<this.length;r++){var o=this[r][0];null!=o&&(n[o]=!0)}for(r=0;r<t.length;r++){var s=t[r];null!=s[0]&&n[s[0]]||(e&&!s[2]?s[2]=e:e&&(s[2]="("+s[2]+") and ("+e+")"),i.push(s))}},i}},function(t,i,e){var n,r,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=n.apply(this,arguments)),r}),a=function(t){var i={};return function(t,e){if("function"==typeof t)return t();if(void 0===i[t]){var n=function(t,i){return i?i.querySelector(t):document.querySelector(t)}.call(this,t,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}i[t]=n}return i[t]}}(),h=null,c=0,l=[],u=e(7);function _(t,i){for(var e=0;e<t.length;e++){var n=t[e],r=o[n.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](n.parts[s]);for(;s<n.parts.length;s++)r.parts.push(m(n.parts[s],i))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(m(n.parts[s],i));o[n.id]={id:n.id,refs:1,parts:a}}}}function f(t,i){for(var e=[],n={},r=0;r<t.length;r++){var o=t[r],s=i.base?o[0]+i.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[s]?n[s].parts.push(a):e.push(n[s]={id:s,parts:[a]})}return e}function p(t,i){var e=a(t.insertInto);if(!e)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=l[l.length-1];if("top"===t.insertAt)n?n.nextSibling?e.insertBefore(i,n.nextSibling):e.appendChild(i):e.insertBefore(i,e.firstChild),l.push(i);else if("bottom"===t.insertAt)e.appendChild(i);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=a(t.insertAt.before,e);e.insertBefore(i,r)}}function d(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var i=l.indexOf(t);i>=0&&l.splice(i,1)}function g(t){var i=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return e.nc}();n&&(t.attrs.nonce=n)}return v(i,t.attrs),p(t,i),i}function v(t,i){Object.keys(i).forEach(function(e){t.setAttribute(e,i[e])})}function m(t,i){var e,n,r,o;if(i.transform&&t.css){if(!(o="function"==typeof i.transform?i.transform(t.css):i.transform.default(t.css)))return function(){};t.css=o}if(i.singleton){var s=c++;e=h||(h=g(i)),n=w.bind(null,e,s,!1),r=w.bind(null,e,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(e=function(t){var i=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",v(i,t.attrs),p(t,i),i}(i),n=function(t,i,e){var n=e.css,r=e.sourceMap,o=void 0===i.convertToAbsoluteUrls&&r;(i.convertToAbsoluteUrls||o)&&(n=u(n));r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var s=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}.bind(null,e,i),r=function(){d(e),e.href&&URL.revokeObjectURL(e.href)}):(e=g(i),n=function(t,i){var e=i.css,n=i.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}.bind(null,e),r=function(){d(e)});return n(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;n(t=i)}else r()}}t.exports=function(t,i){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(i=i||{}).attrs="object"==typeof i.attrs?i.attrs:{},i.singleton||"boolean"==typeof i.singleton||(i.singleton=s()),i.insertInto||(i.insertInto="head"),i.insertAt||(i.insertAt="bottom");var e=f(t,i);return _(e,i),function(t){for(var n=[],r=0;r<e.length;r++){var s=e[r];(a=o[s.id]).refs--,n.push(a)}t&&_(f(t,i),i);for(r=0;r<n.length;r++){var a;if(0===(a=n[r]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var y,b=(y=[],function(t,i){return y[t]=i,y.filter(Boolean).join("\n")});function w(t,i,e,n){var r=e?"":n.css;if(t.styleSheet)t.styleSheet.cssText=b(i,r);else{var o=document.createTextNode(r),s=t.childNodes;s[i]&&t.removeChild(s[i]),s.length?t.insertBefore(o,s[i]):t.appendChild(o)}}},function(t,i){t.exports=function(t){var i="undefined"!=typeof window&&window.location;if(!i)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var e=i.protocol+"//"+i.host,n=e+i.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,i){var r,o=i.trim().replace(/^"(.*)"$/,function(t,i){return i}).replace(/^'(.*)'$/,function(t,i){return i});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?e+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},function(t,i,e){"use strict";e.r(i),e(0);const n={display:null,map:{},engine:null,player:null,pedro:null,ananas:null,init:function(){this.display=new ROT.Display({spacing:1.1}),document.body.appendChild(this.display.getContainer()),this._generateMap();var t=new ROT.Scheduler.Simple;t.add(this.player,!0),t.add(this.pedro,!0),this.engine=new ROT.Engine(t),this.engine.start()},_generateMap:function(){var t=new ROT.Map.Digger,i=[];t.create(function(t,e,n){if(!n){var r=t+","+e;this.map[r]=".",i.push(r)}}.bind(this)),this._generateBoxes(i),this._drawWholeMap(),this.player=this._createBeing(r,i),this.pedro=this._createBeing(o,i)},_createBeing:function(t,i){var e=Math.floor(ROT.RNG.getUniform()*i.length),n=i.splice(e,1)[0].split(",");return new t(parseInt(n[0]),parseInt(n[1]))},_generateBoxes:function(t){for(var i=0;i<10;i++){var e=Math.floor(ROT.RNG.getUniform()*t.length),n=t.splice(e,1)[0];this.map[n]="P",i||(this.ananas=n)}},_drawWholeMap:function(){for(var t in this.map){var i=t.split(","),e=parseInt(i[0]),n=parseInt(i[1]);this.display.draw(e,n,this.map[t])}}};var r=function(t,i){this._x=t,this._y=i,this._draw()};r.prototype.getSpeed=function(){return 100},r.prototype.getX=function(){return this._x},r.prototype.getY=function(){return this._y},r.prototype.act=function(){n.engine.lock(),window.addEventListener("keydown",this)},r.prototype.handleEvent=function(t){var i=t.keyCode;if(13!=i&&32!=i){var e={38:0,33:1,39:2,34:3,40:4,35:5,37:6,36:7};if(i in e){var r=ROT.DIRS[8][e[i]],o=this._x+r[0],s=this._y+r[1];o+","+s in n.map&&(n.display.draw(this._x,this._y,n.map[this._x+","+this._y]),this._x=o,this._y=s,this._draw(),window.removeEventListener("keydown",this),n.engine.unlock())}}else this._checkBox()},r.prototype._draw=function(){n.display.draw(this._x,this._y,"T","#ff0")},r.prototype._checkBox=function(){var t=this._x+","+this._y;"P"!=n.map[t]?alert("There is no protein here"):t==n.ananas?(alert("Hooray! You found an Protein and won this game."),n.engine.lock(),window.removeEventListener("keydown",this)):alert("This Protein bin is empty :-(")};var o=function(t,i){this._x=t,this._y=i,this._draw()};o.prototype.getSpeed=function(){return 100},o.prototype.act=function(){var t=n.player.getX(),i=n.player.getY(),e=new ROT.Path.AStar(t,i,function(t,i){return t+","+i in n.map},{topology:4}),r=[];e.compute(this._x,this._y,function(t,i){r.push([t,i])}),r.shift(),1==r.length?(n.engine.lock(),alert("Game over!")):(t=r[0][0],i=r[0][1],n.display.draw(this._x,this._y,n.map[this._x+","+this._y]),this._x=t,this._y=i,this._draw())},o.prototype._draw=function(){n.display.draw(this._x,this._y,"O","red")};e(3);n.init()}]);